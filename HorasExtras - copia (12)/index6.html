<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Excel</title>
  </head>
  <body>
    <button onclick="excel()">Excel</button>

    <div class="container">
      <table id="tabla" class="table table-secondary table-bordered">
        <thead class="table-dark">
          <tr>
            <th scope="col">Company</th>
            <th scope="col">Contact</th>
            <th scope="col">Country</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Alfreds Futterkiste</td>
            <td>Maria Anders</td>
            <td>Germany</td>
          </tr>
          <tr>
            <td>Centro comercial Moctezuma</td>
            <td>Francisco Chang</td>
            <td>Mexico</td>
          </tr>
        </tbody>
      </table>
      <div>
        <button onclick="sasasa()">Excel2</button>
      </div>
    </div>
  </body>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/1.3.8/FileSaver.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/exceljs/4.3.0/exceljs.min.js"></script>
  <script>
    let data = {
      columns: [
        // {
        //   key: "GmKod",
        //   header: "Kod",
        //   style: {
        //     alignment: { horizontal: "center" },
        //     font: { color: { argb: "F3FF33" }, bold: true },
        //     fill: {
        //       type: "pattern",
        //        pattern: "solid",
        //          fgColor: {argb: "120a8f"}
        //     }
        //   }
        // },
        {
          key: "kisaTarih",
          header: "Kısa Tarih",
          width: 12,
          style: { numFmt: "dd/mm/yyyy" },
        },
        {
          key: "uzunTarih",
          header: "Uzun Tarih",
          width: 35,
          style: { numFmt: "dddd, MMMM dd, yyyy" },
          // outlineLevel: 2,
          // hidden: false
        },
      ],
      data: [
        {
          GmKod: "600.018",
          Aciklama: "FATURALI SATIŞLAR",
          kisaTarih: new Date(Date.UTC(2022, 9, 19, 0, 0, 0)),
          uzunTarih: new Date(Date.UTC(2022, 9, 19, 0, 0, 0)),
          Borclu: 0,
          Alacakli: 1000,
        },
        {
          GmKod: "391.018",
          Aciklama: "FATURALI SATIŞLAR",
          kisaTarih: new Date(Date.UTC(2022, 9, 19, 0, 0, 0)),
          uzunTarih: new Date(Date.UTC(2022, 9, 19, 0, 0, 0)),
          Borclu: 0,
          Alacakli: 180,
        },
        {
          GmKod: "100",
          Aciklama: "FATURALI SATIŞLAR",
          kisaTarih: new Date(Date.UTC(2022, 9, 19, 0, 0, 0)),
          uzunTarih: new Date(Date.UTC(2022, 9, 19, 0, 0, 0)),
          Borclu: 0,
          Alacakli: 1180,
        },
      ],
    };

    function excel() {
      let workbook = new ExcelJS.Workbook();
      let workSheetName = "Hojaaa";
      let workbookName = "ExcelJs.xlsx";
      let worksheet = workbook.addWorksheet(workSheetName, {
        pageSetup: {},
      });

      worksheet.columns = [
        { header: "Id", key: "id", width: 10 },
        { header: "Name", key: "name", width: 20 },
        { header: "D.O.B.", key: "DOB", width: 20, outlineLevel: 1 },
      ];

      worksheet.getCell("A1").font = {
        name: "Arial Black",
        color: { argb: "FF00FF00" },
        family: 2,
        size: 14,
        italic: true,
      };

      worksheet.getCell("B2").border = {
        top: { style: "thin" },
        left: { style: "thin" },
        bottom: { style: "thin" },
        right: { style: "thin" },
      };

      //const row = worksheet.getRow(1);
      //row.style.font = { color: { argb: "FF00FF00" } };
      worksheet.getRow(2).font = {
        name: "Comic Sans MS",
        family: 4,
        size: 16,
        bold: true,
      };
      // const row = worksheet.getRow(5);
      // (row = {
      //   key: "Id",
      //   header: "Id",
      //   style: {
      //     alignment: { horizontal: "center" },
      //     font: { color: { argb: "F3FF33" }, bold: true },
      //     fill: {
      //       type: "pattern",
      //       pattern: "solid",
      //       fgColor: { argb: "120a8f" },
      //     },
      //   },
      // }),

      // worksheet.addConditionalFormatting({
      //   ref: "A2:A4",
      //   rules: [
      //     {
      //       style: {
      //         fill: {
      //           type: "pattern",
      //           pattern: "solid",
      //           bgColor: { argb: "FF00FF00" },
      //         },
      //       },
      //     },
      //   ],
      // });
      // add a checkerboard pattern to A1:E7 based on row + col being even or odd
      // worksheet.addConditionalFormatting({
      //   ref: 'A1:E7',
      //   rules: [
      //     {
      //       type: 'expression',
      //       formulae: ['MOD(ROW()+COLUMN(),2)=0'],
      //       style: {fill: {type: 'pattern', pattern: 'solid', bgColor: {argb: 'FF00FF00'}}},
      //     }
      //   ]
      // })

      worksheet.addRow([3, "Sam", new Date()]);

      const rowValues = [];
      rowValues[1] = 4;
      rowValues[5] = "Kyle";
      rowValues[9] = new Date();
      worksheet.addRow(rowValues);

      //en indice indicado
      worksheet.insertRow(2, [88, "Sam8", new Date()]);

      //   worksheet.getCell("E3").alignment = {
      //     horizontal: "center",
      //   };

      worksheet.eachRow(function (row, rowNumber) {
        row.eachCell(function (cell, colNumber) {
          console.log("Cell " + colNumber + " = " + cell.value);
          row.alignment = { horizontal: "center" };
        });
      });

      workbook.xlsx.writeBuffer().then(function (buffer) {
        saveAs(
          new Blob([buffer], { type: "application/octet-stream" }),
          workbookName
        );
      });
    }

    //let rows = document.getElementById("tabla").children[0].rows;
    //console.log(rows);
    //////////////////////////////////////////////////
    // $("#tabla tr").each(function () {
    //   $(this)
    //     .find("td")
    //     .each(function () {
    //       //do your stuff, you can use $(this) to get current cell
    //       console.log($(this)[0].innerText);
    //     });
    // });
    //////////////////////////////////////////////////
    // $("#tabla tr").each(function () {
    //   $(this)
    //     .find("td")
    //     .each(function () {
    //       //do your stuff, you can use $(this) to get current cell
    //       console.log($(this)[0].innerText);
    //     });
    //   console.log($(this)[0]);
    // });
    //////////////////////////////////////////////////

    function sasasa() {
      let workbook = new ExcelJS.Workbook();
      let workSheetName = "Hojaaa";
      let workbookName = "ExcelJs.xlsx";
      let worksheet = workbook.addWorksheet(workSheetName, {
        pageSetup: {},
      });

      worksheet.columns = [
        { header: "Company", key: "Company", width: 30 },
        { header: "Contact", key: "Contact", width: 20 },
        { header: "Country", key: "Country", width: 15 },
      ];

      let tr = document.querySelectorAll("tbody tr");
      tr.forEach((row) => {
        //console.log(row.children[0].innerHTML);
        const rowValues = [];
        rowValues[1] = row.children[0].innerHTML;
        rowValues[2] = row.children[1].innerHTML;
        rowValues[3] = row.children[2].innerHTML;
        worksheet.addRow(rowValues);
      });

      worksheet.eachRow(function (row, rowNumber) {
        row.eachCell(function (cell, colNumber) {
          console.log("Cell " + colNumber + " = " + cell.value);
          row.alignment = { horizontal: "center" };
        });
      });

      workbook.xlsx.writeBuffer().then(function (buffer) {
        saveAs(
          new Blob([buffer], { type: "application/octet-stream" }),
          workbookName
        );
      });
    }
    //console.log(tr[0].children[0].innerHTML);
  </script>
</html>
